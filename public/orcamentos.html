<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeraÃ§Ã£o de OrÃ§amento com IA - CVC Itaqua</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="shortcut icon" href="https://www.cvc.com.br/favicon.ico" type="image/x-icon">
</head>
<body>
  <header>
    <h1>ğŸ’° GeraÃ§Ã£o de OrÃ§amento com IA</h1>
    <nav>
      <ul>
        <li><a href="index.html">ğŸ“Š Dashboard</a></li>
        <li><a href="orcamentos.html" class="active">ğŸ’° OrÃ§amentos</a></li>
        <li><a href="cadastro-vendas.html">ğŸ“ˆ Vendas</a></li>
        <li><a href="embarques.html">âœˆï¸ Embarques</a></li>
        <li><a href="orbiuns.html">ğŸ“‹ Orbiuns</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- FormulÃ¡rio de OrÃ§amento -->
    <section>
      <h2>ğŸ“ Dados do OrÃ§amento</h2>
      
      <form id="orcamentoForm">
        <div class="form-section">
          <label>Tipo de orÃ§amento:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="tipo" value="AÃ©reo Facial"> âœˆï¸ AÃ©reo Facial</label>
            <label><input type="checkbox" name="tipo" value="AÃ©reo VBI/FÃ¡cil"> âœˆï¸ AÃ©reo VBI/FÃ¡cil</label>
            <label><input type="checkbox" name="tipo" value="Frete"> ğŸ“¦ Frete</label>
            <label><input type="checkbox" name="tipo" value="Hotel"> ğŸ¨ Hotel</label>
            <label><input type="checkbox" name="tipo" value="Cruzeiro"> ğŸš¢ Cruzeiro</label>
            <label><input type="checkbox" name="tipo" value="Carro"> ğŸš— Carro</label>
            <label><input type="checkbox" name="tipo" value="Traslado"> ğŸšŒ Traslado</label>
            <label><input type="checkbox" name="tipo" value="Passeios"> ğŸ¢ Passeios</label>
            <label><input type="checkbox" name="tipo" value="Seguro"> ğŸ›¡ï¸ Seguro</label>
            <label><input type="checkbox" name="tipo" value="Circuito"> ğŸ—ºï¸ Circuito</label>
          </div>
        </div>

        <div class="form-section">
          <label for="destino">ğŸŒ Destino:</label>
          <input type="text" name="destino" id="destino" placeholder="Ex: Orlando, Paris, Buenos Aires">
          
          <label for="adultos">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Adultos:</label>
          <input type="number" name="adultos" id="adultos" min="1" max="10" value="2" required />
          
          <label for="criancas">ğŸ‘¶ CrianÃ§as:</label>
          <input type="number" name="criancas" id="criancas" min="0" max="10" value="0" onchange="atualizarIdadesCriancas()">
          
          <!-- Container para idades das crianÃ§as (aparece dinamicamente) -->
          <div id="containerIdadesCriancas" style="display: none;">
            <label>ğŸ‚ Idades das crianÃ§as:</label>
            <div id="camposIdadesCriancas"></div>
          </div>
          
          <label for="observacoes">ğŸ“ ObservaÃ§Ãµes e dados da viagem:</label>
          <textarea name="observacoes" id="observacoes" 
                    placeholder="Cole aqui dados de passagens, preÃ§os, links ou outras informaÃ§Ãµes especÃ­ficas da viagem..."
                    style="min-height: 200px; resize: vertical;"></textarea>
          <small style="color: #666; font-style: italic;">
            ğŸ’¡ Dica: Cole prints de orÃ§amentos ou informaÃ§Ãµes detalhadas aqui para melhor resultado
          </small>
        </div>

        <div class="form-section">
          <label for="arquivo">ğŸ“ Anexar orÃ§amento (PDF ou imagem):</label>
          <input type="file" id="arquivo" accept=".pdf,.png,.jpg,.jpeg">

          <label>ğŸ“‹ Ou cole texto ou imagem (Ctrl + V):</label>
          <div id="pasteArea" contenteditable="true">
            ğŸ“Œ Clique aqui ou pressione Ctrl+V para colar conteÃºdo
          </div>
          <div id="previewArea"></div>
        </div>

        <button type="submit">ğŸš€ Gerar OrÃ§amento Completo</button>
      </form>
    </section>

    <!-- Resultados -->
    <div class="output-section">
      <h3>ğŸ’° OrÃ§amento Principal
        <button class="copiar" onclick="copiarTexto('orcamentoIA')">ğŸ“‹ Copiar</button>
      </h3>
      <pre id="orcamentoIA">Preencha o formulÃ¡rio acima para gerar o orÃ§amento...</pre>
    </div>

    <!-- SeÃ§Ã£o de Dicas do Destino com BotÃ£o -->
    <div class="output-section">
      <h3>ğŸŒ Dicas do Destino
        <button class="gerar-dicas" onclick="gerarDicasDestino()" id="btnGerarDicas" disabled>
          ğŸ¯ Gerar Dicas
        </button>
        <button class="copiar" onclick="copiarTexto('destinoIA')" style="display: none;" id="btnCopiarDicas">ğŸ“‹ Copiar</button>
      </h3>
      <pre id="destinoIA">Clique em "Gerar Dicas" apÃ³s criar um orÃ§amento para obter informaÃ§Ãµes sobre o destino...</pre>
    </div>

    <div class="output-section">
      <h3>ğŸ¨ Ranking de HotÃ©is
        <button class="copiar" onclick="copiarTexto('rankingIA')">ğŸ“‹ Copiar</button>
      </h3>
      <pre id="rankingIA">SerÃ¡ gerado automaticamente se vocÃª selecionar "Hotel"...</pre>
    </div>

    <!-- Dicas de Uso -->
    <section>
      <h2>ğŸ’¡ Dicas de Uso</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        
        <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px;">
          <h4>ğŸ“ Para melhores resultados:</h4>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Informe destino especÃ­fico</li>
            <li>Cole dados completos nas observaÃ§Ãµes</li>
            <li>Inclua links e preÃ§os reais</li>
            <li>Marque todos os tipos relevantes</li>
          </ul>
        </div>
        
        <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px;">
          <h4>ğŸ¤– O que a IA faz:</h4>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Formata no padrÃ£o CVC</li>
            <li>Detecta mÃºltiplas opÃ§Ãµes automaticamente</li>
            <li>Gera dicas personalizadas do destino</li>
            <li>Pronto para envio por WhatsApp</li>
          </ul>
        </div>
        
      </div>
    </section>
  </main>

  <footer style="text-align: center; padding: 2rem; color: #6c757d; border-top: 1px solid #e9ecef; margin-top: 3rem;">
    <p>Â© 2025 CVC Itaqua | Sistema de OrÃ§amentos com IA</p>
  </footer>

  <script>
    // FunÃ§Ã£o para atualizar campos de idades das crianÃ§as
    function atualizarIdadesCriancas() {
      const qtdeCriancas = parseInt(document.getElementById('criancas').value) || 0;
      const container = document.getElementById('containerIdadesCriancas');
      const camposContainer = document.getElementById('camposIdadesCriancas');
      
      if (qtdeCriancas > 0) {
        container.style.display = 'block';
        camposContainer.innerHTML = '';
        
        for (let i = 1; i <= qtdeCriancas; i++) {
          const div = document.createElement('div');
          div.style.marginBottom = '0.5rem';
          div.innerHTML = `
            <label for="idade_crianca_${i}" style="display: inline-block; width: 120px;">CrianÃ§a ${i}:</label>
            <input type="number" id="idade_crianca_${i}" name="idade_crianca_${i}" 
                   min="0" max="17" placeholder="Idade" 
                   style="width: 80px; margin-right: 10px;">
            <small style="color: #666;">anos</small>
          `;
          camposContainer.appendChild(div);
        }
      } else {
        container.style.display = 'none';
        camposContainer.innerHTML = '';
      }
    }

    // FunÃ§Ã£o para gerar dicas do destino (chamada manual)
    async function gerarDicasDestino() {
      const destino = document.getElementById('destino').value;
      const orcamentoTexto = document.getElementById('orcamentoIA').innerText;
      
      if (!destino) {
        alert('Informe um destino primeiro!');
        return;
      }
      
      const btnGerar = document.getElementById('btnGerarDicas');
      const btnCopiar = document.getElementById('btnCopiarDicas');
      
      btnGerar.disabled = true;
      btnGerar.innerText = 'ğŸ¤– Gerando...';
      
      try {
        // Extrair datas do orÃ§amento se disponÃ­vel
        let contextoData = '';
        if (orcamentoTexto && orcamentoTexto !== 'Preencha o formulÃ¡rio acima para gerar o orÃ§amento...') {
          contextoData = `\n\nCONTEXTO DA VIAGEM:\n${orcamentoTexto.substring(0, 300)}...`;
        }
        
        const prompt = `Crie dicas personalizadas sobre ${destino} para WhatsApp da CVC.${contextoData}
        
Inclua:
- Principais atraÃ§Ãµes e pontos turÃ­sticos
- Melhor Ã©poca para visitar (considerando a Ã©poca da viagem se informada)
- Dicas de clima e o que levar
- InformaÃ§Ãµes prÃ¡ticas (moeda, documentaÃ§Ã£o, fuso horÃ¡rio)
- Tom vendedor mas informativo
- MÃ¡ximo 250 palavras
- Use emojis para deixar atrativo

Se hÃ¡ datas especÃ­ficas na viagem, adapte as dicas para essa Ã©poca do ano.`;

        const response = await callAI(prompt, 'destino', { destino });
        document.getElementById('destinoIA').innerText = response;
        
        btnCopiar.style.display = 'inline-block';
        console.log("âœ… Dicas do destino geradas!");
        
      } catch (error) {
        console.error("âŒ Erro ao gerar dicas:", error);
        document.getElementById('destinoIA').innerText = "âŒ Erro ao gerar dicas: " + error.message;
      } finally {
        btnGerar.disabled = false;
        btnGerar.innerText = 'ğŸ¯ Gerar Dicas';
      }
    }

    // Habilitar botÃ£o de gerar dicas quando orÃ§amento for criado
    function habilitarBotaoDicas() {
      const btnGerar = document.getElementById('btnGerarDicas');
      if (btnGerar) {
        btnGerar.disabled = false;
      }
    }

    // FunÃ§Ã£o local de copiar (mantida para compatibilidade)
    function copiarTexto(id) {
      const texto = document.getElementById(id).innerText;
      navigator.clipboard.writeText(texto).then(() => {
        // Feedback visual
        const button = event.target;
        const originalText = button.innerText;
        button.innerText = "âœ… Copiado!";
        setTimeout(() => {
          button.innerText = originalText;
        }, 2000);
      }).catch(err => {
        console.error("Erro ao copiar:", err);
        alert("Erro ao copiar. Tente selecionar o texto manualmente.");
      });
    }

    // Melhorar Ã¡rea de paste
    const pasteArea = document.getElementById('pasteArea');
    const previewArea = document.getElementById('previewArea');

    if (pasteArea && previewArea) {
      pasteArea.addEventListener('paste', function (e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let i = 0; i < items.length; i++) {
          const item = items[i];

          if (item.type.indexOf('image') !== -1) {
            const blob = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function (event) {
              const img = document.createElement('img');
              img.src = event.target.result;
              img.style.maxWidth = '100%';
              previewArea.innerHTML = '';
              previewArea.appendChild(img);
              previewArea.dataset.fileData = event.target.result;
            };
            reader.readAsDataURL(blob);
          } else if (item.type === 'text/plain') {
            item.getAsString(function (text) {
              previewArea.innerHTML = '<p>' + text + '</p>';
            });
          }
        }
      });

      // Destacar Ã¡rea quando hover
      pasteArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = '#003399';
        this.style.backgroundColor = '#e9ecef';
      });

      pasteArea.addEventListener('dragleave', function(e) {
        this.style.borderColor = '#007bff';
        this.style.backgroundColor = '#f8f9fa';
      });
    }

    // Destacar pÃ¡gina atual na navegaÃ§Ã£o
    document.addEventListener('DOMContentLoaded', function() {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const navLinks = document.querySelectorAll('nav a');
      
      navLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href === currentPage) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    });
  </script>

  <script src="ai.js"></script>
</body>
</html>
