<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📈 Sistema de Vendas - CVC Itaqua</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --cvc-azul: #003399;
            --cvc-amarelo: #FFD700;
            --cvc-verde: #00A859;
            --cvc-azul-claro: #4A90E2;
            --cvc-azul-escuro: #002266;
        }
        
        body {
            background: linear-gradient(135deg, var(--cvc-azul) 0%, var(--cvc-azul-claro) 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            max-width: 1400px;
        }
        
        .header-section {
            background: linear-gradient(135deg, var(--cvc-azul) 0%, var(--cvc-azul-escuro) 100%);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: var(--cvc-amarelo);
            border-radius: 50%;
            opacity: 0.1;
            transform: translate(50%, -50%);
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .cvc-logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--cvc-azul);
            font-size: 18px;
        }
        
        .header-title {
            margin: 0;
            font-weight: 700;
            font-size: 2.2rem;
        }
        
        .header-subtitle {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .nav-pills {
            background: #f8f9fa;
            padding: 20px;
            margin: 0;
            border-radius: 0;
        }
        
        .nav-pills .nav-link {
            border-radius: 10px;
            margin: 0 5px;
            font-weight: 600;
            color: var(--cvc-azul);
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link.active {
            background: var(--cvc-azul);
            color: white;
        }
        
        .nav-pills .nav-link:hover:not(.active) {
            background: var(--cvc-azul-claro);
            color: white;
        }
        
        .content-section {
            padding: 30px;
        }
        
        .form-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }
        
        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--cvc-azul);
        }
        
        .form-section h4 {
            color: var(--cvc-azul);
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--cvc-azul);
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 0.2rem rgba(0, 51, 153, 0.25);
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .radio-item, .checkbox-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .radio-item:hover, .checkbox-item:hover {
            border-color: var(--cvc-azul);
            background: rgba(0, 51, 153, 0.05);
            transform: translateY(-2px);
        }
        
        .radio-item.selected, .checkbox-item.selected {
            border-color: var(--cvc-azul);
            background: rgba(0, 51, 153, 0.1);
            font-weight: 600;
        }
        
        .recibo-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--cvc-verde);
            position: relative;
        }
        
        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .recibo-number {
            background: linear-gradient(135deg, var(--cvc-verde) 0%, #007C42 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .extra-fields {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #fff3cd 0%, #ffe5a0 100%);
            border-radius: 12px;
            border-left: 4px solid var(--cvc-amarelo);
            display: none;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--cvc-verde) 0%, #007C42 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 168, 89, 0.3);
        }
        
        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 168, 89, 0.4);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--cvc-azul);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert-custom {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            z-index: 10000;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .status-conexao {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 51, 153, 0.3);
            z-index: 1000;
            display: none;
        }
        
        .status-conexao.online { background: var(--cvc-verde); }
        .status-conexao.offline { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <div class="header-section">
                <div class="header-content">
                    <div class="d-flex align-items-center justify-content-center flex-wrap">
                        <div class="cvc-logo me-4">CVC</div>
                        <div>
                            <h1 class="header-title"><i class="fas fa-shopping-cart"></i> Cadastro de Vendas</h1>
                            <p class="header-subtitle">Formulário para cadastro de vendas completas - CVC Itaquaquecetuba</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <nav class="nav-pills">
                <ul class="nav nav-pills justify-content-center">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="orcamentos.html"><i class="fas fa-calculator"></i> Orçamentos</a></li>
                    <li class="nav-item"><a class="nav-link active" href="vendas.html"><i class="fas fa-shopping-cart"></i> Vendas</a></li>
                    <li class="nav-item"><a class="nav-link" href="embarques.html"><i class="fas fa-plane-departure"></i> Embarques</a></li>
                    <li class="nav-item"><a class="nav-link" href="orbiuns.html"><i class="fas fa-clipboard-list"></i> Orbiuns</a></li>
                </ul>
            </nav>
            
            <div class="content-section">
                <form id="formVendaCompleta">
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> Informações Gerais</h4>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="nInforme" class="form-label"><i class="fas fa-hashtag"></i> Nº do Informe</label>
                                <input type="number" class="form-control" id="nInforme" name="nInforme" placeholder="Deixe em branco para gerar automático">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label"><i class="fas fa-building"></i> Filial</label>
                                <div class="radio-group">
                                    <div class="radio-item"><input type="radio" name="filial" value="6220" id="filial6220" required><label for="filial6220">6220 - Itaqua</label></div>
                                    <div class="radio-item"><input type="radio" name="filial" value="6223" id="filial6223"><label for="filial6223">6223</label></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="vendedor" class="form-label"><i class="fas fa-user-tie"></i> Vendedor</label>
                                <select class="form-select" id="vendedor" name="vendedor" required>
                                    <option value="">Selecione...</option>
                                    <option value="Alessandro">Alessandro</option>
                                    <option value="Ana Paula">Ana Paula</option>
                                    <option value="Adriana">Adriana</option>
                                    <option value="Adrielly">Adrielly</option>
                                    <option value="Bia">Bia</option>
                                    <option value="Conceição">Conceição</option>
                                    <option value="Jhully">Jhully</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-user"></i> Dados do Cliente</h4>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="cpfCliente" class="form-label"><i class="fas fa-id-card"></i> CPF</label>
                                <input type="text" class="form-control" id="cpfCliente" name="cpfCliente" required placeholder="000.000.000-00" maxlength="14">
                            </div>
                            <div class="col-md-4">
                                <label for="nomeCliente" class="form-label"><i class="fas fa-signature"></i> Nome Completo</label>
                                <input type="text" class="form-control" id="nomeCliente" name="nomeCliente" required>
                            </div>
                            <div class="col-md-4">
                                <label for="whatsappCliente" class="form-label"><i class="fab fa-whatsapp"></i> WhatsApp</label>
                                <input type="text" class="form-control" id="whatsappCliente" name="whatsappCliente" placeholder="(11) 99999-9999" maxlength="15">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-receipt"></i> Recibos e Serviços</h4>
                        <div id="recibosContainer"></div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-success" id="btnAdicionarRecibo"><i class="fas fa-plus-circle"></i> Adicionar Recibo</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-shield-alt"></i> Seguro Viagem</h4>
                        <div class="radio-group">
                            <div class="radio-item"><input type="radio" name="seguro" value="recusado" id="seguroRecusado"><label for="seguroRecusado">❌ Oferecido e RECUSADO</label></div>
                            <div class="radio-item"><input type="radio" name="seguro" value="nao_oferecido" id="seguroNaoOferecido"><label for="seguroNaoOferecido">⚠️ Não Ofertou</label></div>
                            <div class="radio-item"><input type="radio" name="seguro" value="comprou" id="seguroComprou"><label for="seguroComprou">✅ COMPROU</label></div>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit"><i class="fas fa-save"></i> Cadastrar Venda Completa</button>
                </form>
            </div>
        </div>
    </div>

    <div id="statusConexao" class="status-conexao">
        <i class="fas fa-wifi"></i> <span id="statusTexto">Verificando conexão...</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ================================================================================
        // 🔧 CONFIGURAÇÕES
        // ================================================================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbxwckeJGdXdbtidZ3GV7DD3nkgbI8j33Kgh3p8-AIcu9VEjGsWXE4EZhHbEKBM6IuSEoQ/exec';
        const COMPANHIAS_AEREAS = ['LATAM', 'AZUL', 'GOL', 'VOEPASS', '──────────────', 'CRUZEIRO MSC', 'CRUZEIRO COSTA', '──────────────', 'Aerolíneas Argentinas', 'Aeroméxico', 'Air Canada', 'Air China', 'Air Europa', 'Air France', 'American Airlines', 'Arajet', 'Avianca', 'Boliviana de Aviación (BoA)', 'British Airways', 'Copa Airlines', 'Delta Air Lines', 'Emirates', 'Ethiopian Airlines', 'Flybondi', 'Iberia', 'ITA Airways', 'JetSmart', 'KLM', 'Lufthansa', 'Qatar Airways', 'Royal Air Maroc', 'Sky Airline', 'Swiss International Air Lines', 'TAAG Linhas Aéreas de Angola', 'TAP Air Portugal', 'Turkish Airlines', 'United Airlines', 'OUTRAS CIAS'];
        const TIPOS_SERVICO = ['Aéreo', 'Aéreo Facial', 'Hotel', 'A+H', 'A+H+S', 'Passeios', 'Traslados', 'Ingressos', 'Seguro', 'Cruzeiro', 'Locação'];
        let contadorRecibos = 0;
        let conexaoOnline = false;

        // ================================================================================
        // 🚀 INICIALIZAÇÃO
        // ================================================================================
        document.addEventListener('DOMContentLoaded', function() {
            configurarMascaras();
            configurarRadioCheckbox();
            configurarEventos();
            adicionarRecibo();
            document.getElementById('formVendaCompleta').addEventListener('submit', enviarVendaCompleta);
            verificarConexao();
        });

        // ================================================================================
        // 🎯 CONFIGURAÇÃO DE EVENTOS
        // ================================================================================
        function configurarEventos() {
            document.getElementById('btnAdicionarRecibo').addEventListener('click', adicionarRecibo);
        }

        // ================================================================================
        // 🌐 VERIFICAÇÃO DE CONEXÃO
        // ================================================================================
        async function verificarConexao() {
            const statusDiv = document.getElementById('statusConexao');
            const statusTexto = document.getElementById('statusTexto');
            statusDiv.style.display = 'block';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                
                // ✅ CORREÇÃO 1: Simplificando a requisição GET
                const response = await fetch(API_URL, {
                    method: 'GET',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();

                if (data.success) {
                    conexaoOnline = true;
                    statusDiv.className = 'status-conexao online';
                    statusTexto.innerHTML = '<i class="fas fa-check-circle"></i> Sistema Online';
                    setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
                } else {
                    throw new Error('Resposta inválida da API');
                }
            } catch (error) {
                conexaoOnline = false;
                statusDiv.className = 'status-conexao offline';
                statusTexto.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Conexão Falhou';
                mostrarAlerta('❌ Problema de conexão com o servidor. Verifique se o Google Apps Script foi reimplantado.', 'error');
            }
        }

        // ================================================================================
        // 🧾 GERENCIAMENTO DE RECIBOS
        // ================================================================================
        function adicionarRecibo() {
            contadorRecibos++;
            const container = document.getElementById('recibosContainer');
            const reciboDiv = document.createElement('div');
            reciboDiv.className = 'recibo-container';
            reciboDiv.id = `recibo-${contadorRecibos}`;
            
            reciboDiv.innerHTML = `
                <div class="recibo-header">
                    <div class="recibo-number"><i class="fas fa-receipt"></i> Recibo ${contadorRecibos}</div>
                    ${contadorRecibos > 1 ? `<button type="button" class="btn btn-sm btn-danger" onclick="removerRecibo(${contadorRecibos})"><i class="fas fa-trash"></i> Remover</button>` : ''}
                </div>
                <div class="row g-3">
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-hashtag"></i> Nº do Recibo</label><input type="text" class="form-control" name="recibo[]"></div>
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-file-alt"></i> Nº do Pedido</label><input type="text" class="form-control" name="pedido[]"></div>
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-ticket-alt"></i> Reserva</label><input type="text" class="form-control" name="reserva[]"></div>
                </div>
                <div class="row g-3 mt-2">
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-tag"></i> Tipo de Serviço</label><select class="form-select" name="tipo[]" data-recibo="${contadorRecibos}" required>${TIPOS_SERVICO.map(t => `<option value="${t}">${t}</option>`).join('')}</select></div>
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-calendar-alt"></i> Data Ida</label><input type="date" class="form-control" name="dataIda[]" required></div>
                    <div class="col-md-4"><label class="form-label"><i class="fas fa-calendar-check"></i> Data Volta</label><input type="date" class="form-control" name="dataVolta[]"></div>
                </div>
                <div class="extra-fields" id="extras-${contadorRecibos}">
                    <h5 class="mb-3"><i class="fas fa-plane"></i> Detalhes Aéreos</h5>
                    <div class="row g-3">
                        <div class="col-md-4"><label class="form-label"><i class="fas fa-building"></i> Cia Aérea</label><select class="form-select" name="cia[]">${COMPANHIAS_AEREAS.map(c => c.startsWith('─') ? `<option disabled>${c}</option>` : `<option value="${c}">${c}</option>`).join('')}</select></div>
                        <div class="col-md-4"><label class="form-label"><i class="fas fa-link"></i> LOC GDS</label><input type="text" class="form-control" name="locGds[]"></div>
                        <div class="col-md-4"><label class="form-label"><i class="fas fa-link"></i> LOC CIA</label><input type="text" class="form-control" name="locCia[]"></div>
                    </div>
                </div>
                <div class="mt-3"><label class="form-label"><i class="fas fa-comment-dots"></i> Observações</label><textarea class="form-control" name="observacoes[]" rows="2"></textarea></div>
            `;
            container.appendChild(reciboDiv);
            reciboDiv.querySelector('select[name="tipo[]"]').addEventListener('change', (e) => toggleExtras(e.target, contadorRecibos));
        }

        function removerRecibo(numero) {
            document.getElementById(`recibo-${numero}`).remove();
        }

        function toggleExtras(select, id) {
            const extras = document.getElementById(`extras-${id}`);
            if (['Aéreo', 'Aéreo Facial', 'A+H', 'A+H+S'].includes(select.value)) {
                extras.style.display = 'block';
            } else {
                extras.style.display = 'none';
            }
        }

        // ================================================================================
        // 📤 ENVIO DO FORMULÁRIO
        // ================================================================================
        async function enviarVendaCompleta(e) {
            e.preventDefault();
            const submitBtn = e.target.querySelector('.btn-submit');
            const textoOriginal = submitBtn.innerHTML;
            
            if (!conexaoOnline) {
                mostrarAlerta('❌ Sem conexão com o servidor. Tente novamente.', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Enviando...';

            try {
                const dadosVenda = coletarDadosFormulario(e.target);
                if (!validarDadosVenda(dadosVenda)) return;

                const dadosEmbarque = converterParaEmbarques(dadosVenda);
                const payload = { action: 'cadastrar_embarque', dados: dadosEmbarque };
                
                // ✅ CORREÇÃO 2 (PRINCIPAL): Alterando o Content-Type para o POST
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error(`Erro na rede: ${response.statusText}`);
                const result = await response.json();
                
                if (result.success) {
                    mostrarAlerta('✅ Venda cadastrada com sucesso!', 'success');
                    limparFormulario();
                } else {
                    throw new Error(result.error || result.message || 'Erro do servidor');
                }
            } catch (error) {
                mostrarAlerta(`❌ Erro ao cadastrar: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = textoOriginal;
            }
        }

        // ================================================================================
        // ⚙️ FUNÇÕES AUXILIARES DE DADOS
        // ================================================================================
        function coletarDadosFormulario(form) {
            const formData = new FormData(form);
            const dados = {};
            for (let [key, value] of formData.entries()) {
                if (key.endsWith('[]')) {
                    const baseKey = key.slice(0, -2);
                    if (!dados[baseKey]) dados[baseKey] = [];
                    dados[baseKey].push(value);
                } else {
                    dados[key] = value;
                }
            }
            return dados;
        }

        function validarDadosVenda(dados) {
            if (!dados.filial || !dados.vendedor || !dados.cpfCliente || !dados.nomeCliente || !dados.seguro) {
                mostrarAlerta('Preencha todos os campos obrigatórios (Filial, Vendedor, CPF, Nome, Seguro).', 'error');
                return false;
            }
            if (!dados.tipo || !dados.tipo[0] || !dados.dataIda || !dados.dataIda[0]) {
                mostrarAlerta('Adicione pelo menos um recibo com Tipo de Serviço e Data de Ida.', 'error');
                return false;
            }
            return true;
        }
        
        function converterParaEmbarques(dadosVenda) {
            let tipoViagem = 'Nacional';
            if (document.querySelector('#pacoteInternacional')?.checked) tipoViagem = 'Internacional';
            else if (document.querySelector('#pacoteMaritimo')?.checked) tipoViagem = 'Marítimo';
            
            let seguroFinal = 'Não';
            if (dadosVenda.seguro === 'comprou') seguroFinal = 'Sim';
            else if (dadosVenda.seguro === 'recusado') seguroFinal = 'Recusado';
            
            let observacoes = `Filial: ${dadosVenda.filial}. WhatsApp: ${dadosVenda.whatsappCliente || 'N/A'}. `;
            dadosVenda.recibo.forEach((rec, i) => {
                observacoes += `Recibo ${i+1}: ${rec}, Pedido: ${dadosVenda.pedido[i]}, Reserva: ${dadosVenda.reserva[i]}, Tipo: ${dadosVenda.tipo[i]}; `;
            });

            return {
                cpfCliente: dadosVenda.cpfCliente,
                nomeCliente: dadosVenda.nomeCliente,
                vendedor: dadosVenda.vendedor,
                tipoViagem: tipoViagem,
                destino: 'A definir',
                dataIda: dadosVenda.dataIda[0],
                dataVolta: dadosVenda.dataVolta[0] || '',
                vooIda: dadosVenda.cia ? dadosVenda.cia[0] : '',
                seguro: seguroFinal,
                observacoes: observacoes.trim()
            };
        }

        function limparFormulario() {
            document.getElementById('formVendaCompleta').reset();
            document.getElementById('recibosContainer').innerHTML = '';
            contadorRecibos = 0;
            adicionarRecibo();
            document.querySelectorAll('.radio-item.selected, .checkbox-item.selected').forEach(el => el.classList.remove('selected'));
        }

        // ================================================================================
        // 🛠️ OUTRAS FUNÇÕES AUXILIARES
        // ================================================================================
        function configurarMascaras() {
            const cpf = document.getElementById('cpfCliente');
            if(cpf) cpf.addEventListener('input', e => {
                let v = e.target.value.replace(/\D/g, '');
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d)/, '$1.$2');
                v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = v;
            });
        }

        function configurarRadioCheckbox() {
            document.addEventListener('change', e => {
                if (e.target.type === 'radio') {
                    document.querySelectorAll(`input[name="${e.target.name}"]`).forEach(r => r.closest('.radio-item').classList.remove('selected'));
                    e.target.closest('.radio-item').classList.add('selected');
                }
                if (e.target.type === 'checkbox') {
                    e.target.closest('.checkbox-item').classList.toggle('selected', e.target.checked);
                }
            });
        }
        
        function mostrarAlerta(mensagem, tipo = 'info') {
            document.querySelectorAll('.alert-custom').forEach(a => a.remove());
            const alerta = document.createElement('div');
            const icons = { info: 'info-circle', success: 'check-circle', error: 'exclamation-triangle' };
            alerta.className = `alert-custom alert alert-${tipo === 'error' ? 'danger' : tipo} d-flex align-items-center`;
            alerta.innerHTML = `<i class="fas fa-${icons[tipo]} me-2"></i> ${mensagem.replace(/\n/g, '<br>')} <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>`;
            document.body.appendChild(alerta);
            setTimeout(() => alerta.remove(), 8000);
        }
    </script>
</body>
</html>
